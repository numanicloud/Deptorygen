# ファクトリーが自動で依存先クラスを生成する範囲をカスタマイズする

クライアントクラスに必要な依存先クラスが2つ以上あるとき、ファクトリーがその依存先を全て自分で生成することはできないとしても、
自分で生成できるものまでコンストラクタを通じて要求してしまうのは望ましくありません。

なので、Deprovgenで生成したファクトリーは全ての依存先ではなく、自分では生成できない依存先のみをコンストラクタを通じて要求します。

以下はユーザーの書くコードです。

```csharp
using System;
using Deprovgen.Annotations;
using UseDeprovgen.Infra;

namespace UseDeprovgen.Samples.AutoAndManual
{
	// こちらはファクトリーで生成してもらう予定
	class ServiceSilver
	{
		public void Tell()
		{
			Console.WriteLine("I'm Silver.");
		}
	}

	// こちらはファクトリー外で自前で生成する予定
	class ServiceGold
	{
		public void Say()
		{
			Console.WriteLine("I'm Gold.");
		}
	}

	class Client
	{
		private readonly ServiceSilver _silver;
		private readonly ServiceGold _gold;

		public Client(ServiceSilver silver, ServiceGold gold)
		{
			_silver = silver;
			_gold = gold;
		}

		public void Invoke()
		{
			Console.WriteLine("# Client");
			_silver.Tell();
			_gold.Say();
		}
	}

	[Factory]
	interface IFactory
	{
		ServiceSilver ResolveServiceSilver();
		Client ResolveClient();
	}

	class AutoAndManualSample : ISample
	{
		public void Run()
		{
			var factory = new Factory(new ServiceGold());
			factory.ResolveClient().Invoke();
			factory.Dispose();
		}
	}
}
```

以下は生成されるコードです。

```csharp
// <autogenerated />
using System;
using System.Collections.Generic;

namespace UseDeprovgen.Samples.AutoAndManual
{
    internal partial class Factory : IFactory
        , IDisposable
    {
        private readonly ServiceGold _serviceGold;

        private ServiceSilver? _ResolveServiceSilverCache;
        private Client? _ResolveClientCache;

        public Factory(ServiceGold serviceGold)
        {
            _serviceGold = serviceGold;
        }

        public ServiceSilver ResolveServiceSilver()
        {
            return _ResolveServiceSilverCache ??= new ServiceSilver();
        }

        public Client ResolveClient()
        {
            return _ResolveClientCache ??= new Client(ResolveServiceSilver(), _serviceGold);
        }


        
        public void Dispose()
        {
        }
    }
}
```

実行結果は以下の通りです。

```
# Client
I'm Silver.
I'm Gold.
```

`Factory`クラスのコンストラクタでは`ServiceGold`クラスのオブジェクトだけが要求され、
一方で`ServiceSilver`クラスのオブジェクトはファクトリー自身が必要に応じて生成します。

`ServiceSilver`クラスのインスタンスが要求されないのは、
`IFactory`インターフェースとして書かれたファクトリー定義の中に`ServiceSilver`を取得するためのメソッドが含まれているためです。
`ServiceGold`を取得するためのメソッドも用意したならば、`Factory`クラスのコンストラクタは引数が0個となります。
